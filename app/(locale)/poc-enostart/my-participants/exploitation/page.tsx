'use client'
import {TypographyH4} from "@/components/ui/typography";
import {Table, TableBody, TableCell, TableHead, TableHeader, TableRow} from "@/components/ui/table";
import {Button} from "@/components/ui/button";
import {DownloadIcon, FileCheck2Icon, HourglassIcon, ScrollTextIcon, SendIcon, UserIcon, XIcon} from "lucide-react";
import {cn} from "@/lib/utils";
import {useState} from "react";
import {Separator} from "@/components/ui/separator";
import {Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger} from "@/components/ui/dialog";
import {IconFileEuro} from "@tabler/icons-react";
import useParticipants from "@/app/(locale)/poc-enostart/data-refactored/participant/use-participants";

export default function Page() {
    const {exploitation, InMemConsumersSignAllDocuments, sendAllExploitationDocumentsToProducer} = useParticipants()
    const [openModal, setOpenModal] = useState(false)

    function sendAll() {
        sendAllExploitationDocumentsToProducer()
        setOpenModal(false)
    }

    function displayProducerBulletinStatus() {
        return "Document signé"
    }

    function displayProducerAccordsStatus() {
        return "Document signé"
    }

    function displayProducerContractStatus() {
        const numberOfExploitation = exploitation.length
        return "Documents signés" + ` (${numberOfExploitation})`
    }

    return (
        <div className="px-4 space-y-4">
            <div className={"flex justify-between items-center w-full"}>
                <div className={"flex"}>
                    <TypographyH4>
                        Passage en exploitation
                    </TypographyH4>

                </div>
                <Button>Télécharger les documents</Button>
            </div>
            <div className={"font-semibold pt-8"}>Producteur prêt pour démarrage</div>
            <div className={"rounded-xl border border-gray-200 flex flex-col gap-3 py-3 w-max"}>
                <div className={"flex items-center gap-2 w-full  px-4"}>
                    <div className={"flex justify-center rounded-md items-center bg-primary/5 p-2"}>
                        <UserIcon className={'size-6 text-primary'}/>
                    </div>
                    <div className={'grid'}>
                        <div className={"font-semibold"}>Remy Bastien</div>
                        <div className={"text-xs"}>Producteur</div>
                        <div className={"text-xs"}>175 kW</div>
                    </div>
                </div>
                <Separator orientation={"horizontal"}/>
                <div className={"grid grid-cols-[200px_1fr]  px-4"}>
                    <div className={"text-sm text-gray-500"}>{"Bulletin d'adhésion"}</div>
                    <div className={"text-sm text-gray-700"}>{displayProducerBulletinStatus()}</div>
                </div>
                <div className={"grid grid-cols-[200px_1fr]  px-4"}>
                    <div className={"text-sm text-gray-500"}>{"Accords de participation"}</div>
                    <div className={"text-sm text-gray-700"}>{displayProducerAccordsStatus()}</div>
                </div>
                <div className={"grid grid-cols-[200px_1fr]  px-4"}>
                    <div className={"text-sm text-gray-500"}>{"Contrats de vente"}</div>
                    <div className={"text-sm text-gray-700"}>{displayProducerContractStatus()}</div>
                </div>
            </div>
            <div className={"flex w-full justify-between pt-8"}>
                <div className={"font-semibold"}>
                    {"Consommateurs prêts pour démarrage"}
                </div>
            </div>

            <Table>
                <TableHeader>
                    <TableRow>
                        <TableHead>Nom</TableHead>
                        <TableHead>Périmètre</TableHead>
                        <TableHead>Consommation</TableHead>
                        <TableHead>Action</TableHead>
                        {/*<TableHead>Intégré</TableHead> /!* Nouvelle colonne "Intégré" *!/*/}
                    </TableRow>
                </TableHeader>
                <TableBody>
                    {exploitation.map((participant) => (
                        <TableRow className={cn(participant.status === 'integrated' && 'opacity-40')}
                                  key={participant.id}>
                            <TableCell>{participant.name}</TableCell>
                            <TableCell>{participant.perimeter}</TableCell>
                            <TableCell>{participant.consumption}</TableCell>
                            <TableCell>
                                <Button size="sm" className="text-xs text-gray-700" variant="link">
                                    Documents terminés (3)
                                    <DownloadIcon className="size-4 ml-1"/>
                                </Button>
                            </TableCell>
                        </TableRow>
                    ))}
                </TableBody>
            </Table>
            {exploitation.length === 0 && <EmptyUserTable/>}
        </div>
    )
}

function EmptyUserTable() {
    return <div className="max-w-sm w-full min-h-[400px] flex flex-col justify-center mx-auto px-6 py-4">
        <div className="flex justify-center items-center size-[46px] bg-gray-100 rounded-lg dark:bg-neutral-800">
            <UserIcon className={"size-6"}/>
        </div>

        <h2 className="mt-5 font-semibold text-gray-800 dark:text-white">
            Pas de consommateurs prêts pour démarrage
        </h2>
        <p className="mt-2 text-sm text-gray-600 dark:text-neutral-400">
            {"Les consommateurs retournant tout les document signés seront affichés ici."}
        </p>
    </div>
}